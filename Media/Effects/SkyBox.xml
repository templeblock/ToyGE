<?xml version='1.0'?>

<effect>
  <include name='CommonState.xml'/>
  
  <variable type='cbuffer' name='cb_vs_perFrame'>
    <variable type='float4' name='camPos'/>
    <variable type='float4x4' name='viewProj'/>
  </variable>

  <variable type='TextureCube' name='skyboxTex'/>
  
  <shader>
    <![CDATA[
    struct VS_IN
    {
      float3 posL : POSITION;
    };
    
    struct VS_OUT
    {
      float4 posH : SV_POSITION;
      float3 dir : DIRECTION;
    };
    
    VS_OUT SkyBoxVS(VS_IN vsIn)
    {
      VS_OUT vsOut;
      vsOut.posH = mul(float4(vsIn.posL, 1.0f), viewProj);
      vsOut.dir = vsIn.posL;
      return vsOut;
    }
    
    float4 SkyBoxPS(VS_OUT vsOut) : SV_TARGET
    {
      return skyboxTex.Sample(samplerLinear, vsOut.dir);
    }
    
    ]]>
  </shader>

  <variable type='RasterizerState' name='cullNone'>
    <state name='cullMode' value='NONE'/>
    <state name='depthClipEnable' value='false'/>
  </variable>

  <variable type='DepthStencilState' name='skyBoxDSS'>
    <state name='depthEnable' value='false'/>
    <state name='depthWriteMask' value='ZERO'/>
    <state name='stencilEnable' value='true'/>
    <state name='frontFace'>
      <state name='stencilFunc' value='EQUAL'/>
    </state>
    <state name='backFace'>
      <state name='stencilFunc' value='EQUAL'/>
    </state>
    <state name='stencilRef' value='0'/>
  </variable>
  
  <technique>
    <pass>
      <state value='cullNone'/>
      <state value='skyBoxDSS'/>
      <vs entry='SkyBoxVS'/>
      <ps entry='SkyBoxPS'/>
    </pass>
  </technique>
  
</effect>