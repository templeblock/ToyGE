<?xml version="1.0" encoding="utf-8"?>

<effect>

  <variable type="TextureCube" name="prefiltedEnvMap"/>
  <variable type="Texture2D" name="LUT"/>

  <variable type="cbuffer" name="cb_IBL">
    <variable type="float4" name="numMipLevels"/>
  </variable>
  
  <shader>
    <![CDATA[
    
float3 ComputeIBL(float3 R, float roughness, float NoV, float3 F0)
{
  float mipLevel = lerp(0.0f, numMipLevels.x - 1.0f, roughness);
  float2 lutSample = LUT.SampleLevel(samplerLinear, float2(NoV, roughness), 0).xy;
  
  return prefiltedEnvMap.SampleLevel(samplerLinear, R, mipLevel).xyz * (F0 * lutSample.x + lutSample.y);
}
    
    ]]>
  </shader>
</effect>
