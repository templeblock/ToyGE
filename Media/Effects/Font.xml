<?xml version='1.0'?>

<effect>
  <include name='CommonState.xml'/>
  
  <variable type='Texture2DArray' name='fontTex' />

  <variable type='cbuffer' name='cb_fontRender'>
    <variable type='float4x4' name='transform'/>
    <variable type='float4' name='color'/>
  </variable>

  <shader>
    <![CDATA[
    
void FontRenderVS(
  float3 pos : POSITION,
  float3 uvw : TEXCOORD,
  out float4 outPos : SV_POSITION,
  out float3 outUVW : TEXCOORD)
{
	outPos = mul(float4(pos, 1.0f), transform);
  outUVW = uvw;
}

float4 FontRenderPS(
  float4 posH : SV_POSITION,
  float3 uvw : TEXCOORD) : SV_TARGET
{
  float fontSample = fontTex.Sample(samplerLinearClamp, uvw).r * 2.0f - 1.0f;
  fontSample = saturate( (fontSample + 0.8) );
  //float fontSample = fontTex.Sample(samplerLinearClamp, uvw).r;
  
	return fontSample * color;
}
    ]]>
  </shader>

  <variable type='BlendState' name='alphaBlend'>
    <state name='blendRTDesc' index='0'>
      <state name='blendEnable' value='true'/>
      <state name='srcBlend' value='SRC_ALPHA'/>
      <state name='dstBlend' value='INV_SRC_ALPHA'/>
    </state>
  </variable>

  <variable type='RasterizerState' name='cullNone'>
    <state name='cullMode' value='NONE'/>
  </variable>
  
  <technique name='FontRender'>
    <pass>
      <state value='disableDepth'/>
      <state value='cullNone'/>
      <state value='alphaBlend'/>
      <vs entry='FontRenderVS'/>
      <ps entry='FontRenderPS'/>
    </pass>
  </technique>

</effect>