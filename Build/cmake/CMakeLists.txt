PROJECT(ToyGE)

CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

#SetDirs
SET(TOYGE_ROOT_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../..")
SET(TOYGE_BIN_DIR "${TOYGE_ROOT_DIR}/bin")
SET(TOYGE_LIB_DIR "${TOYGE_ROOT_DIR}/lib")

SET(ANTTWEAKBAR_DIR "${TOYGE_ROOT_DIR}/Externals/AntTweakBar")
SET(ASSIMP_DIR ${TOYGE_ROOT_DIR}/Externals/assimp-3.1.1)
SET(BOOST_DIR ${TOYGE_ROOT_DIR}/Externals/boost_1_58_0)
SET(FREEIMAGE_DIR ${TOYGE_ROOT_DIR}/Externals/FreeImage)
SET(FREETYPE_DIR ${TOYGE_ROOT_DIR}/Externals/freetype-2.5.3)
SET(RAPIDXML_DIR ${TOYGE_ROOT_DIR}/Externals/rapidxml-1.13)
SET(DXTEX_DIR ${TOYGE_ROOT_DIR}/Externals/DirectXTex/DirectXTex)

#CoreLibName
SET(TOYGE_CORE_LIB_NAME ToyGE_Core)

SET(BUILD_CONFIG "$<$<CONFIG:Debug>:Debug>$<$<CONFIG:Release>:Release>")

#Target
IF(CMAKE_SIZEOF_VOID_P EQUAL 8)
	SET(PLATFORM_TARGET x64)
	SET(TARGET_64 TRUE)
ELSEIF(CMAKE_SIZEOF_VOID_P EQUAL 4)
	SET(PLATFORM_TARGET x86)
ENDIF()

#
IF(WIN32)
	SET(LIB_SUFFIX .lib)
	SET(DLL_SUFFIX .dll)
ENDIF()

#CompileFlags
ADD_DEFINITIONS(-DUNICODE -D_UNICODE)
IF(MSVC)
	SET(CMAKE_CXX_FLAGS "/DWIN32 /D_WINDOWS /W3 /WX /GR /EHsc /Zi /Wv:14")
	SET(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS} /fp:fast /Ob2")

	SET(CMAKE_EXE_LINKER_FLAGS "/pdbcompress")
	SET(CMAKE_STATIC_LINKER_FLAGS "/pdbcompress")
	SET(CMAKE_SHARED_LINKER_FLAGS "/pdbcompress")
	SET(CMAKE_MODULE_LINKER_FLAGS "/pdbcompress")

	SET(CMAKE_EXE_LINKER_FLAGS_RELEASE "${CMAKE_EXE_LINKER_FLAGS} /DEBUG")
	SET(CMAKE_STATIC_LINKER_FLAGS_RELEASE "${CMAKE_EXE_LINKER_FLAGS} /DEBUG")
	SET(CMAKE_SHARED_LINKER_FLAGS_RELEASE "${CMAKE_EXE_LINKER_FLAGS} /DEBUG")
	SET(CMAKE_MODULE_LINKER_FLAGS_RELEASE "${CMAKE_EXE_LINKER_FLAGS} /DEBUG")
ENDIF()

SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

#CopyDlls
IF(TARGET_64)
	FILE(COPY ${ANTTWEAKBAR_DIR}/lib/AntTweakBar64.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Debug)
	FILE(COPY ${ANTTWEAKBAR_DIR}/lib/AntTweakBar64.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Release)
ELSE()
	FILE(COPY ${ANTTWEAKBAR_DIR}/lib/AntTweakBar.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Debug)
	FILE(COPY ${ANTTWEAKBAR_DIR}/lib/AntTweakBar.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Release)
ENDIF()

FILE(COPY ${ASSIMP_DIR}/lib/${PLATFORM_TARGET}/Debug/assimpd.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Debug)
FILE(COPY ${ASSIMP_DIR}/lib/${PLATFORM_TARGET}/Release/assimp.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Release)

FILE(COPY ${FREEIMAGE_DIR}/lib/${PLATFORM_TARGET}/FreeImage.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Debug)
FILE(COPY ${FREEIMAGE_DIR}/lib/${PLATFORM_TARGET}/FreeImage.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Release)

FILE(COPY ${TOYGE_ROOT_DIR}/Externals/d3dcompiler_47.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Debug)
FILE(COPY ${TOYGE_ROOT_DIR}/Externals/d3dcompiler_47.dll DESTINATION ${TOYGE_BIN_DIR}/${PLATFORM_TARGET}/Release)

ADD_SUBDIRECTORY(Core)
ADD_SUBDIRECTORY(Plugins)
ADD_SUBDIRECTORY(Samples)
ADD_SUBDIRECTORY(Tools)