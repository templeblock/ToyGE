SET(LIB_NAME ${TOYGE_CORE_LIB_NAME})
ADD_DEFINITIONS(-DTOYGE_CORE_SOURCE)

#Input
FILE(GLOB INPUT_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/Input/*.h)
FILE(GLOB INPUT_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/Input/*.cpp)

SOURCE_GROUP("Input\\Header Files" FILES ${INPUT_HEADER_FILES})
SOURCE_GROUP("Input\\Source Files" FILES ${INPUT_SOURCE_FILES})


#Input/Windows
FILE(GLOB INPUT_WINDOWS_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/Input/Windows/*.h)
FILE(GLOB INPUT_WINDOWS_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/Input/Windows/*.cpp)

SOURCE_GROUP("Input\\Windows\\Header Files" FILES ${INPUT_WINDOWS_HEADER_FILES})
SOURCE_GROUP("Input\\Windows\\Source Files" FILES ${INPUT_WINDOWS_SOURCE_FILES})


#Kernel
FILE(GLOB KERNEL_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/Kernel/*.h)
FILE(GLOB KERNEL_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/Kernel/*.cpp)

SOURCE_GROUP("Kernel\\Header Files" FILES ${KERNEL_HEADER_FILES})
SOURCE_GROUP("Kernel\\Source Files" FILES ${KERNEL_SOURCE_FILES})


#Math
FILE(GLOB MATH_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/Math/*.h)
FILE(GLOB MATH_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/Math/*.cpp)

SOURCE_GROUP("Math\\Header Files" FILES ${MATH_HEADER_FILES})
SOURCE_GROUP("Math\\Source Files" FILES ${MATH_SOURCE_FILES})


#Platform
FILE(GLOB PLATFORM_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/Platform/*.h)
FILE(GLOB PLATFORM_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/Platform/*.cpp)

SOURCE_GROUP("Platform\\Header Files" FILES ${PLATFORM_HEADER_FILES})
SOURCE_GROUP("Platform\\Source Files" FILES ${PLATFORM_SOURCE_FILES})


#Platform/Windows
FILE(GLOB PLATFORM_WINDOWS_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/Platform/Windows/*.h)
FILE(GLOB PLATFORM_WINDOWS_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/Platform/Windows/*.cpp)

SOURCE_GROUP("Platform\\Windows\\Header Files" FILES ${PLATFORM_WINDOWS_HEADER_FILES})
SOURCE_GROUP("Platform\\Windows\\Source Files" FILES ${PLATFORM_WINDOWS_SOURCE_FILES})


#RenderEngine
FILE(GLOB RENDERENGINE_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/RenderEngine/*.h)
FILE(GLOB RENDERENGINE_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/RenderEngine/*.cpp)

SOURCE_GROUP("RenderEngine\\Header Files" FILES ${RENDERENGINE_HEADER_FILES})
SOURCE_GROUP("RenderEngine\\Source Files" FILES ${RENDERENGINE_SOURCE_FILES})


#RenderEngine/Effects
FILE(GLOB RENDERENGINE_EFFECTS_HEADER_FILES ${TOYGE_ROOT_DIR}/Core/include/ToyGE/RenderEngine/Effects/*.h)
FILE(GLOB RENDERENGINE_EFFECTS_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/RenderEngine/Effects/*.cpp)

SOURCE_GROUP("RenderEngine\\Effects\\Header Files" FILES ${RENDERENGINE_EFFECTS_HEADER_FILES})
SOURCE_GROUP("RenderEngine\\Effects\\Source Files" FILES ${RENDERENGINE_EFFECTS_SOURCE_FILES})

#RenderEngine/Font
FILE(GLOB RENDERENGINE_FONT_HEADER_FILES "${TOYGE_ROOT_DIR}/Core/include/ToyGE/RenderEngine/Font/*.h")
FILE(GLOB RENDERENGINE_FONT_SOURCE_FILES ${TOYGE_ROOT_DIR}/Core/src/RenderEngine/Font/*.cpp)

SOURCE_GROUP("RenderEngine\\Font\\Header Files" FILES ${RENDERENGINE_FONT_HEADER_FILES})
SOURCE_GROUP("RenderEngine\\Font\\Source Files" FILES ${RENDERENGINE_FONT_SOURCE_FILES})


#Inlcude
INCLUDE_DIRECTORIES(${TOYGE_ROOT_DIR}/Core/include)
INCLUDE_DIRECTORIES(${AntTweakBar_INCLUDE_DIR})
INCLUDE_DIRECTORIES(${Assimp_INCLUDE_DIR})
INCLUDE_DIRECTORIES(${Boost_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${FreeImage_INCLUDE_DIR})
INCLUDE_DIRECTORIES(${FreeType_INCLUDE_DIR})
INCLUDE_DIRECTORIES(${DirectXTex_INCLUDE_DIR})
INCLUDE_DIRECTORIES(${RAPIDXML_DIR}/)
INCLUDE_DIRECTORIES(${MCPP_DIR}/inc)

#GenerateLib
ADD_LIBRARY(${LIB_NAME} SHARED
	${INPUT_HEADER_FILES} ${INPUT_SOURCE_FILES}
	${INPUT_WINDOWS_HEADER_FILES} ${INPUT_WINDOWS_SOURCE_FILES}
	${KERNEL_HEADER_FILES} ${KERNEL_SOURCE_FILES}
	${MATH_HEADER_FILES} ${MATH_SOURCE_FILES}
	${PLATFORM_HEADER_FILES} ${PLATFORM_SOURCE_FILES}
	${PLATFORM_WINDOWS_HEADER_FILES} ${PLATFORM_WINDOWS_SOURCE_FILES}
	${RENDERENGINE_HEADER_FILES} ${RENDERENGINE_SOURCE_FILES}
	${RENDERENGINE_EFFECTS_HEADER_FILES} ${RENDERENGINE_EFFECTS_SOURCE_FILES}
	${RENDERENGINE_FONT_HEADER_FILES} ${RENDERENGINE_FONT_SOURCE_FILES}
	${RENDERENGINE_SHADER_FILES})

# Add link libs
SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
    debug ${Assimp_LIBRARY_DEBUG}
    optimized ${Assimp_LIBRARY_RELEASE})
SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
    debug ${AntTweakBar_LIBRARY_DEBUG}
    optimized ${AntTweakBar_LIBRARY_RELEASE})
SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
    debug ${FreeImage_LIBRARY_DEBUG}
    optimized ${FreeImage_LIBRARY_RELEASE})
SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
    debug ${FreeType_LIBRARY_DEBUG}
    optimized ${FreeType_LIBRARY_RELEASE})
SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
    debug ${DirectXTex_LIBRARY_DEBUG}
    optimized ${DirectXTex_LIBRARY_RELEASE})
SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
    debug ${MCPP_DIR}/lib/${PLATFORM_TARGET}/mcpp${LIB_DEBUG_SUFFIX}.lib
    optimized ${MCPP_DIR}/lib/${PLATFORM_TARGET}/mcpp${LIB_RELEASE_SUFFIX}.lib)
IF(WIN32)
	SET(LINKED_LIBARARIES ${LINKED_LIBARARIES} 
		Shlwapi)
ENDIF()

TARGET_LINK_LIBRARIES(
    ${LIB_NAME} PRIVATE ${LINKED_LIBARARIES})


#Properties
SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
	PROJECT_LABEL ${LIB_NAME})

SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
	FOLDER "Core")

SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${TOYGE_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${TOYGE_OUTPUT_DIR}/Debug
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${TOYGE_OUTPUT_DIR}/Release
	OUTPUT_NAME ${LIB_NAME})

SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
	RUNTIME_OUTPUT_DIRECTORY ${TOYGE_OUTPUT_DIR}
	RUNTIME_OUTPUT_DIRECTORY_DEBUG ${TOYGE_OUTPUT_DIR}/Debug
	RUNTIME_OUTPUT_DIRECTORY_RELEASE ${TOYGE_OUTPUT_DIR}/Release
	OUTPUT_NAME ${LIB_NAME})

SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES
	LIBRARY_OUTPUT_DIRECTORY ${TOYGE_OUTPUT_DIR}
	LIBRARY_OUTPUT_DIRECTORY_DEBUG ${TOYGE_OUTPUT_DIR}/Debug
	LIBRARY_OUTPUT_DIRECTORY_RELEASE ${TOYGE_OUTPUT_DIR}/Release
	OUTPUT_NAME ${LIB_NAME})

ADD_CUSTOM_COMMAND(TARGET ${TOYGE_CORE_LIB_NAME} 
	POST_BUILD
	COMMAND ${CMAKE_COMMAND} -E copy $<$<CONFIG:Debug>:${AntTweakBar_BINARY_DEBUG}>$<$<CONFIG:Release>:${AntTweakBar_BINARY_RELEASE}> ${TOYGE_OUTPUT_DIR}/${BUILD_CONFIG}
	COMMAND ${CMAKE_COMMAND} -E copy $<$<CONFIG:Debug>:${Assimp_BINARY_DEBUG}>$<$<CONFIG:Release>:${Assimp_BINARY_RELEASE}> ${TOYGE_OUTPUT_DIR}/${BUILD_CONFIG}
    COMMAND ${CMAKE_COMMAND} -E copy $<$<CONFIG:Debug>:${FreeImage_BINARY_DEBUG}>$<$<CONFIG:Release>:${FreeImage_BINARY_RELEASE}> ${TOYGE_OUTPUT_DIR}/${BUILD_CONFIG}
	)


